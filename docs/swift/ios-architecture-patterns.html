<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Artur Gurgul - iOS Architecture Patterns</title>
  <meta name="author" content="Artur Gurgul" />
  <meta name="description" content="The blog of Artur Gurgul" />
  
  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Artur Gurgul" href="artgur.net/atom.xml" />
  <link rel="stylesheet" href="/assets/css/all.css">

  <style>
    #post pre {
      background-color: white;
      border-left: 12px solid #eee;
      padding: 0 .8em;
    }

    #post code {
      background-color: transparent;
    }

    #stalker {
      float: inherit;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="four columns sidebar no-print">
      <nav>
  <!-- <a href="/">
    <img src="/logo.png" id="logo" alt="Blog logo"/>
  </a>
  <div id="social">
    <div id="stalker" style="text-align: center; width:100%">
      
      <a title="artur-gurgul on Github" href="https://github.com/artur-gurgul">
        <i class="fa fa-github-square"></i>
      </a>
      
    
      
      <a title="Artur Gurgul on Stack Overflow" href="http://stackoverflow.com/users/743268">
        <i class="fa fa-stack-overflow"></i>
      </a>
      
    
    
      
      <a title="Artur Gurgul on LinkedIn" href="https://www.linkedin.com/in/gurgul">
        <i class="fa fa-linkedin-square"></i>
      </a>
      
      
    </div>
  </div>
   -->

   <h2 style="font-size: 20px;margin: 0px;">Hi. I'm <a href="/"> Artur Gurgul</a>,</h2>
   <h2 style="font-size: 15px;margin-top: -0.5em;">and this is my notepad.</h2>
  <hr class="hr-text" data-content="Contents"/>
  
  <ul id="blog-posts" class="posts">
    <!-- <li><span style="font-weight: bold; color: #3498db;">&raquo;</span><a href="/" style="font-weight: 600;">Selected</a></li> -->
  
    
    <li><span>&raquo;</span><a href="/software/wayland-apps.html"
      
      

      >Starting an electron app on wayland</a></li>
  
    
    <li><span>&raquo;</span><a href="/software/vim.html"
      
      

      >Vim notes</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/view-modifier.html"
      
      

      >Add share gesture as view modifier</a></li>
  
    
    <li><span>&raquo;</span><a href="/git/squash.html"
      
      

      >Git - merge & squash commits</a></li>
  
    
    <li><span>&raquo;</span><a href="/solid.html"
      
      

      >SOLID principles</a></li>
  
    
    <li><span>&raquo;</span><a href="/regex/regex-find-any.html"
      
      

      >Regex - Find any</a></li>
  
    
    <li><span>&raquo;</span><a href="/javascript/js-closure.html"
      
      

      >Javascript closure</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/dynamic-member-lockup.html"
      
      

      >Dynamic member lockup in swift</a></li>
  
    
    <li><span>&raquo;</span><a href="/software/debian/debian-sid.html"
      
      

      >Installing Debian sid on QEMU</a></li>
  
    
    <li><span>&raquo;</span><a href="/software/debian/debian-chroot.html"
      
      

      >Chroot environment of Debian sid</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/cancel-upstream.html"
      
      

      >Cancelling a publisher</a></li>
  
    
    <li><span>&raquo;</span><a href="/programming/bridging.html"
      
      

      >Bridging between languages</a></li>
  
    
    <li><span>&raquo;</span><a href="/linux/recepies/power-management.html"
      
      

      >Ubuntu - Power management</a></li>
  
    
    <li><span>&raquo;</span><a href="/linux/mounting-qcow2-image.html"
      
      

      >Linux - Mount disk from qcow2 image</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/ios-architecture-patterns.html"
      
      
        style="font-weight: bold;"
      

      >iOS Architecture Patterns</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/combine-framework-notes.html"
      
      

      >Publishers notes and examples</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/blurable.html"
      
      

      >Blurable view in UIKit</a></li>
  
    
    <li><span>&raquo;</span><a href="/swift/threading.html"
      
      

      >Threading</a></li>
  
    
    <li><span>&raquo;</span><a href="/linux/recepies/creating-ram-disk.html"
      
      

      >Linux - RAM disk</a></li>
  
    
    <li><span>&raquo;</span><a href="/recepies.html"
      
      

      >Recepies</a></li>
  
  </ul>
</nav>

    </div>

    <div class="eleven columns content">
      <h1 class="title">iOS Architecture Patterns</h1>

<div id="post">
  <h3 id="remove-story-board-dependency">Remove story board dependency</h3>

<ol>
  <li>Remove <code class="language-plaintext highlighter-rouge">Main.storyboard</code> file</li>
  <li>Remove storyboard reference from <code class="language-plaintext highlighter-rouge">Info.plist</code> → In Scene Configuration find <code class="language-plaintext highlighter-rouge">Storyboard Name</code> and delete it</li>
  <li>Go to build settings and remove <code class="language-plaintext highlighter-rouge">UIKit MainStoryboard File Base Name</code> field</li>
  <li>Create a window in Scene Delegate</li>
</ol>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">scene</span><span class="p">(</span><span class="n">_</span> <span class="nv">scene</span><span class="p">:</span> <span class="kt">UIScene</span><span class="p">,</span>
           <span class="n">willConnectTo</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">UISceneSession</span><span class="p">,</span>
           <span class="n">options</span> <span class="nv">connectionOptions</span><span class="p">:</span> <span class="kt">UIScene</span><span class="o">.</span><span class="kt">ConnectionOptions</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">scene</span> <span class="o">=</span> <span class="p">(</span><span class="n">scene</span> <span class="k">as?</span> <span class="kt">UIWindowScene</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    
    <span class="k">let</span> <span class="nv">window</span> <span class="o">=</span> <span class="kt">UIWindow</span><span class="p">(</span><span class="nv">windowScene</span><span class="p">:</span> <span class="n">scene</span><span class="p">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="kt">ViewController</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="nf">makeKeyAndVisible</span><span class="p">()</span>
    <span class="k">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="dependency-injection">Dependency injection</h2>

<!-- https://www.swiftbysundell.com/tips/testing-code-that-uses-static-apis/ -->

<p><a href="https://www.avanderlee.com/swift/dependency-injection/">Explanation of the code under this link</a></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">InjectionKey</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">Value</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">currentValue</span><span class="p">:</span> <span class="k">Self</span><span class="o">.</span><span class="kt">Value</span> <span class="p">{</span> <span class="k">get</span> <span class="k">set</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">InjectedValues</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">current</span> <span class="o">=</span> <span class="kt">InjectedValues</span><span class="p">()</span>
    
    <span class="kd">static</span> <span class="kd">subscript</span><span class="o">&lt;</span><span class="kt">K</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">K</span><span class="o">.</span><span class="k">Type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">K</span><span class="o">.</span><span class="kt">Value</span> <span class="k">where</span> <span class="kt">K</span> <span class="p">:</span> <span class="kt">InjectionKey</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">key</span><span class="o">.</span><span class="n">currentValue</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">key</span><span class="o">.</span><span class="n">currentValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">static</span> <span class="kd">subscript</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">keyPath</span><span class="p">:</span> <span class="kt">WritableKeyPath</span><span class="o">&lt;</span><span class="kt">InjectedValues</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">T</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="n">current</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">keyPath</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">current</span><span class="p">[</span><span class="nv">keyPath</span><span class="p">:</span> <span class="n">keyPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@propertyWrapper</span>
<span class="kd">struct</span> <span class="kt">Injected</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">keyPath</span><span class="p">:</span> <span class="kt">WritableKeyPath</span><span class="o">&lt;</span><span class="kt">InjectedValues</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span>
    <span class="k">var</span> <span class="nv">wrappedValue</span><span class="p">:</span> <span class="kt">T</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="kt">InjectedValues</span><span class="p">[</span><span class="n">keyPath</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="kt">InjectedValues</span><span class="p">[</span><span class="n">keyPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">keyPath</span><span class="p">:</span> <span class="kt">WritableKeyPath</span><span class="o">&lt;</span><span class="kt">InjectedValues</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">keyPath</span> <span class="o">=</span> <span class="n">keyPath</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="define-dependency">Define dependency</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">struct</span> <span class="kt">UsersRepositoryKey</span><span class="p">:</span> <span class="kt">InjectionKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">currentValue</span><span class="p">:</span> <span class="kt">AnyUsersRepository</span> <span class="o">=</span> <span class="kt">UsersRepository</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">InjectedValues</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">usersRepository</span><span class="p">:</span> <span class="kt">AnyUsersRepository</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">Self</span><span class="p">[</span><span class="kt">UsersRepositoryKey</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="k">Self</span><span class="p">[</span><span class="kt">UsersRepositoryKey</span><span class="o">.</span><span class="k">self</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">AnyUsersRepository</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getUsers</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">User</span><span class="p">],</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">UsersRepository</span><span class="p">:</span> <span class="kt">AnyUsersRepository</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getUsers</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">User</span><span class="p">],</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">&lt;</span><span class="err">#</span><span class="kt">Implementation</span><span class="err">#</span><span class="o">&gt;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@Injected</span><span class="p">(\</span><span class="o">.</span><span class="n">usersRepository</span><span class="p">)</span> <span class="k">var</span> <span class="nv">usersRepository</span><span class="p">:</span> <span class="kt">AnyUsersRepository</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">InjectedValues</span><span class="p">[\</span><span class="o">.</span><span class="n">usersRepository</span><span class="p">]</span> <span class="o">=</span> <span class="kt">MockedUsersRepository</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="model-view-controller">Model-View-Controller</h2>

<h4 id="clasic-version">Clasic version</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">View</code> and <code class="language-plaintext highlighter-rouge">Model</code> are linked together, so reusability is reduced.</li>
  <li>Note: Views in iOS apps are quite often reusable.</li>
</ul>

<p>
 <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="473px" height="186px" viewBox="-0.5 -0.5 473 186" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-11-07T18:34:22.657Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/22.0.3 Chrome/114.0.5735.289 Electron/25.8.4 Safari/537.36&quot; version=&quot;22.0.3&quot; etag=&quot;Iz-bp9UTBWzNTIIgo6GH&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;xkBbz92YaXBT8ljpGPb4&quot;&gt;7VlbV6MwEP41fdQDoRf62Iu6D+6u53j29phCSrOmDCektvXXbwJJIQUrWmvr6hPky2RIMt98DKHljearK46T2VcICWshJ1y1vHELIdfv9uVFIWuNSChHIk5DjRXALX0gGnQ0uqAhSS1DAcAETWwwgDgmgbAwzDksbbMpMPupCY5IBbgNMKuiv2goZjnqo16BfyE0mpknu2bFc2yM9UrSGQ5hWYK8i5Y34gAiv5uvRoSp3TP7ko+7fKR3MzFOYtFkAMoH3GO20GvT8xJrs1gSyrXrJnAxgwhizC4KdMhhEYdEeXRkq7C5Bkgk6ErwLxFirQOJFwIkJGfI17/VoHPUMe0/2knWGK+s1lq3phCLETDg2fw8x+k6WD58mAoOd+TxHhMqpH2YRan5YUajWN4H8lFEDh8yPCHsBlIqKFgd94QLKqlwvWUwp2GY7YYxGGiXm47M5RAHd1G2YWaiMcSqN993tdlWKFNY8EBDOkkE5hHZUKsacXfDI5mBBOZEbp404YRhQe9t91hnQrSx00MHnON1ySABGou05PlGAdJAZzXyNaN1Tvct3smb3KFplWZWQBk363nqVXj6IwmxILVszUJTF9Tt0ExACJgrBpOUPuBJ5kRRTK9WeuwMW51xPekGCp8Bpw+yDzPNpJcTpwk/lBOyatWInJ59IS1lSqB6SmhHzrnj+8gK35l2/jzSFKwwJjCdppKrNhWeG/z2SYjUvho1GNfoTlWZalUsG3sQ/Wi/vn5Ykd4R1s4jOZ1+JnWjpG7vTOoz+Vrt+p0TSuNuJd4jucccGJNbuR1yO12nlLGtrVOxu8RzylTKfU9ILMff4jg9UIHwwjg2yCs9oI3sF6h5ny6LAtM1JrNScdl19s/E3hEFdkVFrq+9jm5u9FXeF/KqGkZdC1W2NFm7eG+ybGq4si53jyfLflWWU5WgziBQ4vZfqXOa4IDG0VBPatw+rGL3nijDUK/Xtsswbz/9XtcOeBU17x9fM9yyYBT68VE145i1nDmZKdHhiqjvRWeR1XRhxozPD7amStF/Qilc37wiTqK0M3Qshf8nJcunqrodJVx9wffuqjrUsas65LxhWece83TP1HWWRqOGGu3aGo1eV6PrLKtc2V+j2zUafYDzusZ0qB6ifQNBp/Tzi7uhKru7z9HkJ7fb8+0C7pTO0dzqQZr+OfPRZbrrvJ1My2bxfyePYvGbzLv4Bw==&lt;/diagram&gt;&lt;/mxfile&gt;" class="center-image">
  <g>
    <path d="M 171 14 L 31.05 14 L 31 115.76" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 31 121.76 L 27 113.76 L 31 115.76 L 35 113.77 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="35.24" y="8.55">Update</text>
    </g>
    <path d="M 291 34 L 410.95 34 L 411 115.76" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 411 121.76 L 406.99 113.77 L 411 115.76 L 414.99 113.76 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="367.87" y="29.55">Updates</text>
    </g>
    <rect x="171" y="4" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="230.5" y="38.5">Controller</text>
    </g>
    <path d="M 91 124 L 90.95 49.05 L 162.76 49.01" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 168.76 49 L 160.77 53.01 L 162.76 49.01 L 160.76 45.01 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="114.98" y="44.59">User Actions</text>
    </g>
    <path d="M 121 169 L 342.76 169" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 348.76 169 L 340.76 173 L 342.76 169 L 340.76 165 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="256.82" y="164.55">Gets updated state</text>
    </g>
    <rect x="1" y="124" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="60.5" y="158.5">View</text>
    </g>
    <path d="M 351 139 L 129.24 139" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 123.24 139 L 131.24 135 L 129.24 139 L 131.24 143 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="256.29" y="133.55">Notifies</text>
    </g>
    <rect x="351" y="124" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="410.5" y="158.5">Model</text>
    </g>
  </g>
</svg>
</p>

<h4 id="apple-version">Apple version</h4>

<p>
 <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="473px" height="187px" viewBox="-0.5 -0.5 473 187" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-11-07T18:35:04.577Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/22.0.3 Chrome/114.0.5735.289 Electron/25.8.4 Safari/537.36&quot; version=&quot;22.0.3&quot; etag=&quot;K1wkrmuddXaPyJl6GV6f&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;i07ux6VTKLeM-OTNBLxs&quot;&gt;5ZhNU9swEIZ/TY5k/BHHzjEf0B5oywzTFo7CVhwVxeuRFZLw6yvZq9iOTYCEQEpPWK9Wa0n76kFxxx3PV18ESWffIKK841jRquNOOo5jB/2B+qOVNSpKKpRYsAi1UrhmjxRFC9UFi2hWC5QAXLK0LoaQJDSUNY0IAct62BR4/a0piWlDuA4Jb6q/WSRnhRo4fql/pSyemTfbZsVzYoJxJdmMRLCsSO55xx0LAFk8zVdjyvXumX0pxl080buZmKCJfMkApxjwQPgC14bzkmuzWBqptWMThJxBDAnh56U6ErBIIqozWqpVxlwCpEq0lfiHSrnGQpKFBCWpGYr1jR7UdTzTvsUkeWOyqrXW2JpCIsfAQeTzcy2rbxH18lEmBdzTp3tMqRzMYRal50c4ixP1HKpXUTV8xMkd5VeQMcmg1vFAhWTKCpdbAXMWRflumIAhptx05ClHJLyP8w0zE00g0b3FvuvNrpUyg4UIUcJDIomIKVZ30Cy4vbGROoAU5lTtnQoRlBPJHurZCR6EeBOHQ4dCkHUlIAWWyKyS+UoLKgAPtRP4Xa/IiYfaDZyq89RDkdO0KpMrpdyd7U51G079mUZE0la/5sVpK+t2ce5ASphrD9OMPZK7PIk2GS5YZfRGHW/Sbruh1mcg2KPqIxy9tL91spSELIlHOKky2zOu0YnpqtOCPlxRCZyqU5x2p2Aiq2sFWENT0zNM/jovlWYxITCdZsrBdXu81hC9k0DXoeQaTlpo1ORVK9vysXTF5A2O08+3FaKqZjkT3TATOQaKbOftWVSzxw4veE/AIfvMdHCPS4feTjqcKY/1A++EeNBveGCs9l0A52p7t21QP/dTxvnW1ul6XpA54/rI/EhposZfkyQ70v1jzzq+4KzhgJ7T+Aft44FdlldY2xhhVrm+9q3DD6j/gbBGQFpd36sycicgS8LX+I4p3hnxB9N60KR1/+NgHTRhnekjag1DjbxPzez+cZntP3Ojc3y/V7/RuYcRfN064E14PmjY5Bejy+dIvgPb7ZD/50jueNsk7w3ekeTmG8zHotzZA+X2UVHeFtl0y8EoN7fsE2G5bTfc8B0km7LPffW27VK8pFO96WfOS39Y7cl222qvaXkht/2gDvdT+rlujFtxCn4Z/t+B3rfeE+iqWX5eLupYfqV3z/8C&lt;/diagram&gt;&lt;/mxfile&gt;" class="center-image">
  <g>
    <path d="M 170.5 15 L 30.53 15 L 30.5 116.76" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 30.5 122.76 L 26.5 114.76 L 30.5 116.76 L 34.5 114.76 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="34.74" y="8.55">Update</text>
    </g>
    <path d="M 290.5 20 L 410.53 20.05 L 410.5 116.76" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 410.5 122.76 L 406.5 114.76 L 410.5 116.76 L 414.5 114.77 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="372.63" y="12.59">Updates</text>
    </g>
    <rect x="170.5" y="5" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="230" y="39.5">Controller</text>
    </g>
    <path d="M 90.5 125 L 90.53 50.05 L 162.26 50.01" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 168.26 50 L 160.27 54.01 L 162.26 50.01 L 160.26 46.01 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="114.55" y="43.59">User Actions</text>
    </g>
    <rect x="0.5" y="125" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="60" y="159.5">View</text>
    </g>
    <path d="M 380.5 125 L 380.53 50.05 L 298.74 50" fill="none" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke" />
    <path d="M 292.74 50 L 300.74 46.01 L 298.74 50 L 300.73 54.01 Z" fill="#0060ad" stroke="#0060ad" stroke-width="2" stroke-miterlimit="10" pointer-events="all" />
    <g fill="#0060AD" font-family="Helvetica" text-anchor="middle" font-size="10.999999999999998px">
      <text x="371.55" y="42.18">Notifies</text>
    </g>
    <rect x="350.5" y="125" width="120" height="60" fill="none" stroke="#0060ad" stroke-width="2" pointer-events="all" />
    <g fill="#0060ad" font-family="Open Sans" font-weight="bold" text-anchor="middle" font-size="11.999999999999998px">
      <text x="410" y="159.5">Model</text>
    </g>
  </g>
</svg>
</p>

<p><strong>Model</strong> responsibilities:</p>

<ul>
  <li>Business logic</li>
  <li>Accessing and manipulating data</li>
  <li>Persistence</li>
  <li>Communication/Networking</li>
  <li>Parsing</li>
  <li>Extensions and helper classes</li>
  <li>Communication with models</li>
</ul>

<p>Note: The <code class="language-plaintext highlighter-rouge">Model</code> must not communicate directly with the <code class="language-plaintext highlighter-rouge">View</code>. The <code class="language-plaintext highlighter-rouge">Controller</code> is the link between those</p>

<p><strong>View</strong> responsibilities:</p>

<ul>
  <li>Animations, drawings (<code class="language-plaintext highlighter-rouge">UIView</code>,  <code class="language-plaintext highlighter-rouge">CoreAnimation</code>, <code class="language-plaintext highlighter-rouge">CoreGraphics</code>)</li>
  <li>Show data that controller sends</li>
  <li>Might receive user input</li>
</ul>

<p><strong>Controller</strong> responsibilities:</p>

<ul>
  <li>Exchange data between <code class="language-plaintext highlighter-rouge">View</code> and <code class="language-plaintext highlighter-rouge">Model</code></li>
  <li>Receive user actions and interruptions or signals from the outside the app</li>
  <li>Handles the view life cycle</li>
</ul>

<h4 id="advantages">Advantages</h4>

<ul>
  <li>Simple and usually less code</li>
  <li>Fast development for simple apps</li>
</ul>

<h4 id="disadvantages">Disadvantages</h4>

<ul>
  <li>Controllers coupled views</li>
  <li>Massive <code class="language-plaintext highlighter-rouge">ViewController</code>s</li>
</ul>

<h4 id="communication-between-components">Communication between components</h4>

<ul>
  <li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/TargetAction.html">Delegation</a> pattern</li>
  <li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/TargetAction.html">Target-Action</a> pattern</li>
  <li><a href="https://developer.apple.com/documentation/foundation/nsnotificationcenter">Observer</a> pattern with <code class="language-plaintext highlighter-rouge">NSNotificationCenter</code></li>
  <li><a href="https://developer.apple.com/documentation/swift/using-key-value-observing-in-swift">Observer</a> pattern with <code class="language-plaintext highlighter-rouge">KVO</code></li>
</ul>

<h2 id="model-view-presenter">Model-View-Presenter</h2>

<p>In this design pattern View is implemented with classes <code class="language-plaintext highlighter-rouge">UIView</code> and <code class="language-plaintext highlighter-rouge">UIViewController</code>. The <code class="language-plaintext highlighter-rouge">UIViewController</code> has less responsibilities which are limited to:</p>

<ul>
  <li>Routing/Coordination</li>
  <li>Navigation</li>
  <li>Passing informations via a delegation pattern</li>
</ul>

<h4 id="view">View</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ExampleController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
	<span class="kd">private</span> <span class="k">let</span> <span class="nv">exampleView</span> <span class="o">=</span> <span class="kt">ExampleView</span><span class="p">()</span>
	<span class="k">override</span> <span class="kd">func</span> <span class="nf">loadView</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">super</span><span class="o">.</span><span class="nf">loadView</span><span class="p">()</span>
		<span class="nf">setup</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="kd">private</span> <span class="kd">func</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">presenter</span> <span class="o">=</span> <span class="kt">ExamplePresenter</span><span class="p">(</span><span class="n">exampleView</span><span class="p">)</span>
		<span class="n">exampleView</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
		<span class="n">exampleView</span><span class="o">.</span><span class="nf">setupView</span><span class="p">()</span>
		<span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">exampleView</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="presenter">Presenter</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">ExampleViewDelegate</span> <span class="p">{</span>
	<span class="kd">func</span> <span class="nf">updateView</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="kt">ExamplePresenter</span> <span class="p">{</span>
	<span class="kd">private</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">exampleView</span><span class="p">:</span> <span class="kt">ExampleViewDelegate</span><span class="p">?</span>
	<span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">exampleView</span><span class="p">:</span> <span class="kt">ExampleViewDelegate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">self</span><span class="o">.</span><span class="n">exampleView</span> <span class="o">=</span> <span class="n">exampleView</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="advantages-1">Advantages</h4>

<ul>
  <li>Easier to test business logic</li>
  <li>Better separation of responsibilities</li>
</ul>

<h4 id="disadvantages-1">Disadvantages</h4>

<ul>
  <li>Usually not a better choice for smaller projects</li>
  <li>Presenters might become massive</li>
  <li>Controllers still handle navigation. Possible solutions →  extend the pattern with Router or Coordinator.</li>
</ul>

<!--
https://nalexn.github.io/clean-architecture-swiftui/
## VIPER

**`Entity.swift`**

```swift
struct User: Codable {
    let name: String
}
```

**`Interactor.swift`**

```swift
enum FetchError: Error {
    case failed
}

protocol AnyInteractor {
    var presenter: AnyPresenter? { get set }
    
    func getUsers()
}

class UserInteractor: AnyInteractor {
    @Injected(\.usersRepository) var usersRepository: AnyUsersRepository
    
    var presenter: AnyPresenter?
    
    func getUsers() {
        usersRepository.getUsers { [weak self] in self?.presenter?.interactorDidFetchUsers(with: $0) }
    }
}
```


**`Presenter.swift`**

```swift
protocol AnyPresenter {
    var router: AnyRouter? { get set }
    var interactor: AnyInteractor? { get set }
    var view: AnyView? { get set }
    
    func interactorDidFetchUsers(with result: Result<[User], Error>)
}

class UserPresenter: AnyPresenter {
    func interactorDidFetchUsers(with result: Result<[User], Error>) {
        switch result {
        case let .success(users):
            view?.update(with: users)
        case let .failure(error):
            view?.update(with: error.localizedDescription)
        }
    }
    
    var router: AnyRouter?
    
    var interactor: AnyInteractor? {
        didSet {
            interactor?.getUsers()
        }
    }
    
    var view: AnyView?
}
```

**`Router.swift`**

```swift
typealias EntryPoint = AnyView & UIViewController

protocol AnyRouter {
    var entry: EntryPoint? { get }
    static func start() -> AnyRouter
}

class UserRouter: AnyRouter {
    var entry: EntryPoint?
    
    
    static func start() -> AnyRouter {
        let router = UserRouter()
        
        var view: AnyView = UserViewController()
        var presenter: AnyPresenter = UserPresenter()
        var interactor: AnyInteractor = UserInteractor()
        
        view.presenter = presenter
        
        interactor.presenter = presenter
        
        presenter.router = router
        presenter.view = view
        presenter.interactor = interactor
        
        router.entry = view as? EntryPoint
        
        return router
    }
}



//There are a few retain cycles with view, presenter, router and interactor. One option you can do is to make those protocols conforms to AnyObject, and mark these references as "weak":
//1. router's ref to presenter
//2. router's ref to view
//3. presenter's ref to view
//4. interactor's ref to presenter
```

**`View.swift`**

```swift
protocol AnyView {
    var presenter: AnyPresenter? { get set }
    
    func update(with users: [User])
    func update(with error: String)
}

class UserViewController: UIViewController, AnyView {
    
    
    var presenter: AnyPresenter?
    
    private let tableView: UITableView = {
        let tableView = UITableView()
        tableView.register(UITableViewCell.self, forCellReuseIdentifier: "cell")
        tableView.isHidden = true
        return tableView
    }()
    
    var users = [User]()
    
    override func viewDidLoad() {
        super.viewDidLoad()
        view.addSubview(tableView)
        tableView.delegate = self
        tableView.dataSource = self
    }
    
    override func viewDidLayoutSubviews() {
        super.viewDidLayoutSubviews()
        tableView.frame = view.bounds
    }
    
    func update(with users: [User]) {
        DispatchQueue.main.async {
            self.users = users
            self.tableView.reloadData()
            self.tableView.isHidden = false
        }
    }
    
    func update(with error: String) {
        
    }
}


extension UserViewController: UITableViewDelegate, UITableViewDataSource {
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        users.count
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "cell", for: indexPath)
        cell.textLabel?.text = users[indexPath.row].name
        return cell
    }
}
```



# Factory

```swift
protocol ImageReader {
    func getDecodeImage() -> DecodedImage
}

class DecodedImage {
    private var image: String

    init(image: String) {
        self.image = image
    }

    var description: String {
        "\(image): is decoded"
    }
}

class GifReader: ImageReader {
    private var decodedImage: DecodedImage

    init(image: String) {
        self.decodedImage = DecodedImage(image: image)
    }

    func getDecodeImage() -> DecodedImage {
        decodedImage
    }
}

class JpegReader: ImageReader {
    private var decodedImage: DecodedImage

    init(image: String) {
        decodedImage = DecodedImage(image: image)
    }

    func getDecodeImage() -> DecodedImage {
        decodedImage
    }
}

func runFactoryExample() {
    let reader: ImageReader
    let format = "gif"
    let image = "example image"

    switch format {
    case "gif":
        reader = GifReader(image: image)
    default:
        reader = JpegReader(image: image)
    }
    
    let decodedImage = reader.getDecodeImage()
    print(decodedImage.description)
}
```


```swift

protocol Observer<ValueType> {
    associatedtype ValueType
    func update(value: ValueType)
}

struct Subject<T> {    
    private var observers: [(T) -> Void] = []
    
    mutating func attach<O: Observer>(observer: O) where O.ValueType == T {
        observers.append { observer.update(value: $0) }
    }

    func notyfi(value: T) {
        for observer in observers {
            observer(value)
        }
    }
}

class ConcreteObserver: Observer {
    func update(value: String) {
        print("received: \(value)")
    }
}

func runObserverExample() {
    var subject = Subject<String>()

    let observer1 = ConcreteObserver()
    subject.attach(observer: observer1)

    let observer2 = ConcreteObserver()
    subject.attach(observer: observer2)
    
    subject.notyfi(value: "some string")
}

// Version with more modern syntax
/*
protocol Observer<ValueType> {
    associatedtype ValueType
    func update(value: ValueType)
}

struct Subject<T> {
    private var observers = Array<any Observer<T>>()

    mutating func attach(observer: any Observer<T>) {
        observers.append(observer)
    }

    func notify(value: T) {
        for observer in observers {
            observer.update(value: value)
        }
    }
}
*/

```
-->


</div>

        
    <ul class="tag_list_in_post"></ul>
      <div class="footer">
        <div class="disclaimer">
  <p>
  © Artur Gurgul, 2016 &mdash; Public Domain Licence
  </p>
</div>

      </div>
    </div>
  </div>

  
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41036379-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
